# 基于 Scapy 编写端口扫描器

## 实验目的
掌握网络扫描之端口状态探测的基本原理

## 实验环境
python + scapy

## 实验要求
1.禁止探测互联网上的 IP ，严格遵守网络安全相关法律法规

2.完成以下扫描技术的编程实现
TCP connect scan 
TCP stealth scan
TCP Xmas scan 
TCP fin scan 
TCP null scan
UDP scan

3.上述每种扫描技术的实现测试均需要测试端口状态为：开放、关闭 和 过滤 状态时的程序执行结果

提供每一次扫描测试的抓包结果并分析与课本中的扫描方法原理是否相符？如果不同，试分析原因；

在实验报告中详细说明实验网络环境拓扑、被测试 IP 的端口状态是如何模拟的

## 实验过程

### 1.构建网络拓扑
![图片](作业5.1.jpg)

### 2.模拟端口状态配置
防火墙关闭，对应端口没有开启监听, 防火墙没有开启。
开启状态，对应端口开启监听，防火墙关闭
过滤状态：对应端口开启监听, 防火墙开启

### 3.实验代码脚本
code.py
执行结果：
![图片](作业5.2.png)

### 4.各个实验结果

#### 1.TCP connect scan
先发送SYN请求，等待回应;
如果回应标识为RST，则目标端口处于关闭状态;
如果回应标识为ACK，则目标端口处于开放状态.

端口开启状态时：
![图片](作业5.3.jpg)

抓包情况：
![图片](作业5.5.jpg)

端口关闭状态时：
![图片](作业5.6.jpg)

抓包情况：
![图片](作业5.8.jpg)

端口过滤：
![图片](作业5.9.jpg)

抓包情况：
![图片](作业5.10.jpg)

#### 2.TCP Stealth Scan
攻击主机发出的SYN请求之后，返回一个SYN+ACK回应，说明目标端口开放，返回一个RST+ACK回应，说明目标端口关闭。

只有在目标端口处于关闭状态时，才会在收到攻击主机返回的RST包

端口开启、关闭、过滤时的状态如下：
![图片](作业5.23.jpg)
![图片](作业5.24.jpg)

抓包分析：
![图片](作业5.25.jpg)

#### 3.TCP Xmas Scan
只有在目标端口处于关闭状态时，才会在收到攻击主机返回的RST包

端口开启、关闭、过滤时的状态如下：
![图片](作业5.11.jpg)
![图片](作业5.12.jpg)

抓包分析：
![图片](作业5.13.jpg)

#### 4.TCP Fin Scan
目标端口只会在关闭状态下对攻击主机发送的FIN包回复一个RST包

端口开启、关闭、过滤时的状态如下：
![图片](作业5.14.jpg)
![图片](作业5.15.jpg)

抓包分析：
![图片](作业5.16.jpg)

#### 5.TCP null Scan
目标端口也只会在关闭状态对攻击主机发送的包回复一个RST包

端口开启、关闭、过滤时的状态如下：
![图片](作业5.17.jpg)
![图片](作业5.18.jpg)

抓包分析：
![图片](作业5.19.jpg)

#### 6.UDP Scan
当攻击者主机收到来自目标端口的UDP回复时，说明该端口为开启状态，反之为过滤或者关闭状态
![图片](作业5.20.jpg)
![图片](作业5.21.jpg)

抓包分析：
![图片](作业5.22.jpg)

## 实验问题
本次实验最大的问题是一开始遇到了代码执行问题，在 python 环境已经配置好，里面也是有 scapy 包的情况下，并且下载不了dnsmasq：
![图片](作业5.26.jpg)
最后发现是可能之前用过第三方 APT 源,重新导入 kali 系统进行实验
